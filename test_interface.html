<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipsCommerce Core Pipeline Test Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        .pipeline-flow {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }
        .flow-step {
            flex: 1;
            margin: 0 5px;
        }
        .flow-arrow {
            margin: 0 10px;
            color: #007bff;
            font-weight: bold;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h2 {
            color: #444;
            margin-top: 0;
        }
        input, textarea, button, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .btn-full-pipeline {
            background-color: #28a745;
            font-size: 18px;
            padding: 15px;
            margin: 20px 0;
        }
        .btn-full-pipeline:hover {
            background-color: #218838;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ClipsCommerce Core Pipeline</h1>
        <div class="subtitle">Brand URL > Brand Info > Viral Content > Video Outlines > Production Guides > SEO Optimization</div>
        
        <div class="pipeline-flow">
            <div class="flow-step">Brand Analysis</div>
            <div class="flow-arrow">></div>
            <div class="flow-step">Content Ideas</div>
            <div class="flow-arrow">></div>
            <div class="flow-step">Video Outlines</div>
            <div class="flow-arrow">></div>
            <div class="flow-step">Production Guides</div>
            <div class="flow-arrow">></div>
            <div class="flow-step">SEO Optimization</div>
        </div>

        <!-- Full Pipeline Section -->
        <div class="section">
            <h2>[ROCKET] Full Pipeline (Recommended)</h2>
            <input type="text" id="pipelineBrandUrl" placeholder="Brand Website URL (e.g., https://example.com)" value="">
            <input type="number" id="pipelineContentCount" placeholder="Number of content ideas" value="5" min="1" max="20">
            <button class="btn-full-pipeline" onclick="runFullPipeline()">Run Complete Pipeline</button>
            <div id="pipelineResponse" class="response" style="display: none;"></div>
        </div>

        <!-- Individual Steps Section -->
        <div class="section">
            <h2>[STEPS] Individual Pipeline Steps</h2>
            
            <!-- Step 1: Brand Analysis -->
            <h3>Step 1: Brand Analysis</h3>
            <input type="text" id="brandUrl" placeholder="Brand Website URL" value="">
            <button onclick="analyzeBrand()">Analyze Brand</button>
            <div id="brandResponse" class="response" style="display: none;"></div>
            
            <!-- Step 2: Content Ideas -->
            <h3>Step 2: Generate Content Ideas</h3>
            <textarea id="brandData" placeholder="Brand data from Step 1 (JSON)" rows="3"></textarea>
            <textarea id="productsData" placeholder="Products data from Step 1 (JSON)" rows="3"></textarea>
            <input type="number" id="contentCount" placeholder="Number of content ideas" value="10" min="1" max="50">
            <button onclick="generateContentIdeas()">Generate Content Ideas</button>
            <div id="contentResponse" class="response" style="display: none;"></div>
            
            <!-- Step 3: Video Outlines -->
            <h3>Step 3: Create Video Outlines</h3>
            <textarea id="contentIdeas" placeholder="Content ideas from Step 2 (JSON)" rows="3"></textarea>
            <button onclick="createVideoOutlines()">Create Video Outlines</button>
            <div id="outlineResponse" class="response" style="display: none;"></div>
            
            <!-- Step 4: Generate Production Guides -->
            <h3>Step 4: Create Production Guides</h3>
            <textarea id="videoOutlines" placeholder="Video outlines from Step 3 (JSON)" rows="3"></textarea>
            <button onclick="generateProductionGuides()">Create Production Guides</button>
            <div id="productionResponse" class="response" style="display: none;"></div>
            
            <!-- Step 5: SEO Optimization -->
            <h3>Step 5: SEO Optimization</h3>
            <button onclick="optimizeSEO()">Optimize for SEO</button>
            <div id="seoResponse" class="response" style="display: none;"></div>
        </div>

        <!-- Status Section -->
        <div class="section">
            <h2>[STATUS] Pipeline Status</h2>
            <input type="text" id="jobId" placeholder="Job ID">
            <button onclick="checkPipelineStatus()">Check Status</button>
            <div id="statusResponse" class="response" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';

        async function apiCall(endpoint, method = 'GET', body = null) {
            const headers = {
                'Content-Type': 'application/json',
            };

            const config = {
                method,
                headers,
            };

            if (body) {
                config.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const data = await response.json();
                
                return {
                    ok: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    ok: false,
                    status: 0,
                    data: { error: error.message }
                };
            }
        }

        function showResponse(elementId, response) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(response, null, 2);
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            setTimeout(() => statusDiv.remove(), 5000);
        }

        // Full Pipeline Function
        async function runFullPipeline() {
            const brandUrl = document.getElementById('pipelineBrandUrl').value;
            const contentCount = document.getElementById('pipelineContentCount').value;

            if (!brandUrl) {
                showStatus('Please enter a brand URL', 'error');
                return;
            }

            showStatus('Starting full pipeline...', 'info');
            
            const pipelineData = {
                brand_url: brandUrl,
                content_count: parseInt(contentCount)
            };

            const response = await apiCall('/pipeline/full-pipeline', 'POST', pipelineData);
            showResponse('pipelineResponse', response);
            
            if (response.ok) {
                showStatus('Full pipeline completed successfully!', 'success');
            } else {
                showStatus('Pipeline failed', 'error');
            }
        }

        // Individual Step Functions
        async function analyzeBrand() {
            const brandUrl = document.getElementById('brandUrl').value;

            if (!brandUrl) {
                showStatus('Please enter a brand URL', 'error');
                return;
            }

            showStatus('Analyzing brand...', 'info');
            
            const brandData = {
                brand_url: brandUrl
            };

            const response = await apiCall('/pipeline/analyze-brand', 'POST', brandData);
            showResponse('brandResponse', response);
            
            if (response.ok) {
                showStatus('Brand analysis completed!', 'success');
                // Auto-populate the next step's fields
                document.getElementById('brandData').value = JSON.stringify(response.data.brand, null, 2);
                document.getElementById('productsData').value = JSON.stringify(response.data.products, null, 2);
            } else {
                showStatus('Brand analysis failed', 'error');
            }
        }

        async function generateContentIdeas() {
            const brandDataText = document.getElementById('brandData').value;
            const productsDataText = document.getElementById('productsData').value;
            const contentCount = document.getElementById('contentCount').value;

            if (!brandDataText || !productsDataText) {
                showStatus('Please provide brand and products data from Step 1', 'error');
                return;
            }

            try {
                const brandData = JSON.parse(brandDataText);
                const productsData = JSON.parse(productsDataText);

                showStatus('Generating content ideas...', 'info');
                
                const requestData = {
                    brand_data: brandData,
                    products: productsData,
                    content_count: parseInt(contentCount)
                };

                const response = await apiCall('/pipeline/generate-content-ideas', 'POST', requestData);
                showResponse('contentResponse', response);
                
                if (response.ok) {
                    showStatus('Content ideas generated!', 'success');
                    // Auto-populate the next step
                    document.getElementById('contentIdeas').value = JSON.stringify(response.data.content_ideas, null, 2);
                } else {
                    showStatus('Content generation failed', 'error');
                }
            } catch (error) {
                showStatus('Invalid JSON data provided', 'error');
            }
        }

        async function createVideoOutlines() {
            const contentIdeasText = document.getElementById('contentIdeas').value;
            const brandDataText = document.getElementById('brandData').value;

            if (!contentIdeasText || !brandDataText) {
                showStatus('Please provide content ideas from Step 2 and brand data', 'error');
                return;
            }

            try {
                const contentIdeas = JSON.parse(contentIdeasText);
                const brandData = JSON.parse(brandDataText);

                showStatus('Creating video outlines...', 'info');
                
                const requestData = {
                    content_ideas: contentIdeas,
                    brand_data: brandData
                };

                const response = await apiCall('/pipeline/create-video-outlines', 'POST', requestData);
                showResponse('outlineResponse', response);
                
                if (response.ok) {
                    showStatus('Video outlines created!', 'success');
                    // Auto-populate the next step
                    document.getElementById('videoOutlines').value = JSON.stringify(response.data.video_outlines, null, 2);
                } else {
                    showStatus('Video outline creation failed', 'error');
                }
            } catch (error) {
                showStatus('Invalid JSON data provided', 'error');
            }
        }

        async function generateProductionGuides() {
            const videoOutlinesText = document.getElementById('videoOutlines').value;
            const brandDataText = document.getElementById('brandData').value;

            if (!videoOutlinesText || !brandDataText) {
                showStatus('Please provide video outlines from Step 3 and brand data', 'error');
                return;
            }

            try {
                const videoOutlines = JSON.parse(videoOutlinesText);
                const brandData = JSON.parse(brandDataText);

                showStatus('Creating detailed production guides...', 'info');
                
                const requestData = {
                    video_outlines: videoOutlines,
                    brand_data: brandData
                };

                const response = await apiCall('/pipeline/generate-production-guide', 'POST', requestData);
                showResponse('productionResponse', response);
                
                if (response.ok) {
                    showStatus('Production guides created! Ready to film high-quality videos.', 'success');
                } else {
                    showStatus('Production guide creation failed', 'error');
                }
            } catch (error) {
                showStatus('Invalid JSON data provided', 'error');
            }
        }

        async function optimizeSEO() {
            const videoOutlinesText = document.getElementById('videoOutlines').value;
            const brandDataText = document.getElementById('brandData').value;

            if (!videoOutlinesText || !brandDataText) {
                showStatus('Please provide video outlines and brand data', 'error');
                return;
            }

            try {
                const videoOutlines = JSON.parse(videoOutlinesText);
                const brandData = JSON.parse(brandDataText);

                showStatus('Optimizing for SEO...', 'info');
                
                const requestData = {
                    video_outlines: videoOutlines,
                    brand_data: brandData
                };

                const response = await apiCall('/pipeline/optimize-seo', 'POST', requestData);
                showResponse('seoResponse', response);
                
                if (response.ok) {
                    showStatus('SEO optimization completed!', 'success');
                } else {
                    showStatus('SEO optimization failed', 'error');
                }
            } catch (error) {
                showStatus('Invalid JSON data provided', 'error');
            }
        }

        async function checkPipelineStatus() {
            const jobId = document.getElementById('jobId').value;
            if (!jobId) {
                showStatus('Please enter a job ID', 'error');
                return;
            }

            showStatus('Checking pipeline status...', 'info');
            const response = await apiCall(`/pipeline/pipeline-status/${jobId}`);
            showResponse('statusResponse', response);
            
            if (response.ok) {
                showStatus('Pipeline status retrieved!', 'success');
            } else {
                showStatus('Failed to get pipeline status', 'error');
            }
        }

        // Initialize the interface
        window.onload = function() {
            showStatus('Core Pipeline Interface loaded with REAL backend services!', 'info');
            
            // Add real example URLs for testing
            document.getElementById('pipelineBrandUrl').value = 'https://theordinary.com';
            document.getElementById('brandUrl').value = 'https://theordinary.com';
        };
    </script>
</body>
</html>